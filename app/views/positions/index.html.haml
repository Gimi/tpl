- #---------------------------------------- head
- content_for :head do
  = stylesheet_link_tag "positions/index"
  = link_jqueryui_stylesheet 'humanity'
  = javascript_include_tag 'positions/index'
  = include_google_jsapi jquery: '1.3', jqueryui: '1.7'

- #---------------------------------------- sidebar
- sidebar t('tools') => [[t('.add_position'), new_position_path, {class: 'button-link-add-position'}]]

- #---------------------------------------- content
%h2= t('.title')
- #position-table
#positions
  %div
    - @positions.each do |position|
      %h3
        %span.toggler= link_to_icon 'minimize', 'toggle', '#'
        %span.text.name&= position.name
        %span.text.category ( #{h position.category.name} )
        %span.text.state= position.state
        %span.tools
          %ul.horizontal
            %li= link_to_icon 'folder_files', t('.details'), position_profiles_path(position), :action_name => 'show'
            %li= link_to_icon 'action_add', t('.add_profile'), new_position_profile_path(position), :action_name => 'add'
      .clear-float
      - unless position.profiles.blank?
        .profiles
          %table
            %thead
              %tr
                %th= t :name
                %th= t :state
                %th= t :created_at
                %th= t :operation
            %tbody
              - position.profiles.each_with_index do |profile, index|
                - break if index > 4
                %tr
                  %td&= profile.name
                  %td= profile.state
                  %td= l profile.created_at, :format => :short
                  %td= profile.state_events
- if @positions.empty?
  %p.notice= t('.no_positions', :new_link => link_to(t(:here), new_position_path, class: 'button-link-add-position'))

- #---------------------------------------- dialogs
#position-form.dialog{'data-dialog-title' => t('.create_position'), 'data-dialog-width' => 600, 'data-dialog-height' => 300}
  %form{:action => positions_path, :method => "POST"}
    %table
      %tbody
        %tr
          %td
            %label(for="position[category]")= t('position.category')
          %td
            %select(name="position[category]")
              = options_from_collection_for_select @categories, 'id', 'name'
            = link_to "(#{t '.add'})", categories_path, class: 'button-link-add-category'
        %tr
          %td
            %label(for="position[name]")= t 'position.name'
          %td
            %input(type="text" name="position[name]")
        %tr
          %td
            %label(for="position[description]")= t :description
          %td
            %textarea(name="position[description]")
        %tr
          %td
            %label(for="position[need]")= t 'position.need'
          %td
            %input(type="text" name="position[need]")

#category-form.dialog.modal{'data-dialog-title' => t('.create_category')}
  %form{:action => categories_path, :method => "POST"}
    %table
      %tbody
        %tr
          %td
            %label(for="category[name]")= t :name
          %td
            %input(type="text" name="category[name]")
        %tr
          %td
            %label(for="category[description]")= t :description
          %td
            %textarea(name="category[description]")
